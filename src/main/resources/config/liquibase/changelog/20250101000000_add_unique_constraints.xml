<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">

    <changeSet author="copilot" id="20250101000000-1" dbms="postgresql">
        <comment>Add unique constraints on natural keys to prevent duplicate entities</comment>
        
        <!-- Add unique constraint on ref (url, origin) -->
        <addUniqueConstraint 
            tableName="ref" 
            columnNames="url, origin" 
            constraintName="ref_url_origin_key"/>
        
        <!-- Add unique constraint on ext (tag, origin) -->
        <addUniqueConstraint 
            tableName="ext" 
            columnNames="tag, origin" 
            constraintName="ext_tag_origin_key"/>
        
        <!-- Add unique constraint on plugin (tag, origin) -->
        <addUniqueConstraint 
            tableName="plugin" 
            columnNames="tag, origin" 
            constraintName="plugin_tag_origin_key"/>
        
        <!-- Add unique constraint on template (tag, origin) -->
        <addUniqueConstraint 
            tableName="template" 
            columnNames="tag, origin" 
            constraintName="template_tag_origin_key"/>
        
        <!-- Add unique constraint on users (tag, origin) -->
        <addUniqueConstraint 
            tableName="users" 
            columnNames="tag, origin" 
            constraintName="users_tag_origin_key"/>
    </changeSet>

</databaseChangeLog>
